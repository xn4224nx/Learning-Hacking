#include <stdio.h>
#include <stdlib.h>
#include <string.h>


int main(int argc, char **argv)
{
	char *char_ptr;
	int *int_ptr;
	int mem_size;
	
	/* If the memory has not been supplied set its value. */
	if (argc < 2)
	    mem_size = 50;
	else
	    mem_size = atoi(argv[1]);
	
	/* Allocate memory on the heap */
	printf("\t[+] allocating %d bytes of memory for char_ptr\n", mem_size);
    char_ptr = (char *) malloc(mem_size);
    
    /* Check the memory has been allocated correctly. */
    if (char_ptr == NULL) {
        fprintf(stderr, "Error: could not allocate heap memory.\n");
        exit(-1);
    }  
    
    /* Use the previously allocated memory. */
    strcpy(char_ptr, "This is memory on the heap!");
    printf("char_ptr (%p) --> '%s'\n\n", char_ptr, char_ptr);
    
    /* More memory allocation on the heap. */
	printf("\t[+] allocating 12 bytes of memory for int_ptr\n");
    int_ptr = (int *) malloc(12);   
    
    /* Check the memory has been allocated correctly. */
    if (int_ptr == NULL) {
        fprintf(stderr, "Error: could not allocate heap memory.\n");
        exit(-1);
    }      
	
	/* Use the previous allocated memory */
	*int_ptr = 31337;
	printf("int_ptr (%p) --> '%d'\n\n", int_ptr, *int_ptr);
	
	/* Free up memory */
	printf("Freeing up `char_ptr` ...\n");
	free(char_ptr);
    
	/* Allocate memory on the heap */
	printf("\t[+] allocating %d bytes of memory for char_ptr\n", 15);
    char_ptr = (char *) malloc(mem_size);
    
    /* Check the memory has been allocated correctly. */
    if (char_ptr == NULL) {
        fprintf(stderr, "Error: could not allocate heap memory.\n");
        exit(-1);
    }  
    
    /* Use the previously allocated memory. */
    strcpy(char_ptr, "new memory");
    printf("char_ptr (%p) --> '%s'\n\n", char_ptr, char_ptr);	
    
    /* Free up the allocated memory. */
    printf("Freeing up `char_ptr` and `int_ptr` ...\n");
    free(char_ptr);
    free(int_ptr);
	
	return 0;
}


















