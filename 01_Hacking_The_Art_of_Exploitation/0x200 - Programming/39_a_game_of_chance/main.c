#include "a_game_of_chance.h"

/* Initialise the global player variable as NULL */
struct user cur_player = {NULL};

int main(int argc, char **argv) {
    
    int choice, last_game;
    
    /* Seed the randomiser with the current time. */
    srandom(time(0));
    
    /* Try to read the user data. */
    if(get_player_data() == -1)
        register_new_player();
    
    while(choice != 7) {
        printf("-=[ Game of Chance Menu ]=-\n");
        printf("1 - Play the Pick a Number game\n");
        printf("2 - Play the No Match Dealer game\n");
        printf("3 - Play the Find the Ace game\n");
        printf("4 - View current high score\n");
        printf("5 - Change your user name\n");
        printf("6 - Reset your account at %d credits\n", STARTING_CREDITS);
        printf("7 - Quit\n");
        printf("[Name: %s]\n", cur_player.name);
        printf("[You have %u credits] -> ", cur_player.credits);
        
        /* Get the user's choice. */
        scanf("%d", &choice);
    
        /* Check the choice is valid. */
        if((choice < 1) || (choice > 7)) {
            printf("\n[!!] The number %d is invalid.\n", choice);
            continue;
            
        } else if(choice < 4) {
            
            if(choice != last_game) {
                if(choice == 1)
                    cur_player.current_game = pick_a_number;
                else if(choice == 2)
                    cur_player.current_game = dealer_no_match;
                else
                    cur_player.current_game = find_the_ace;
                
                last_game = choice;
            }
            play_the_game(); 
        }

        if(choice == 4) show_highscore();
        
        if(choice == 5) {
            printf("\nChange username\n");
            printf("Enter you new username: ");
            
            /* Clear stdin */
            while(getchar() != '\n') {}
            
            input_name();
            printf("Your name has been changed!\n\n");
        }
        
        if(choice == 6) {
            printf("\nYour account has been reset to %d credits.\n\n", 
                STARTING_CREDITS);
            cur_player.credits = STARTING_CREDITS;
        }
    }
    
    update_player_data();
    printf("\nThanks for playing! Bye.\n");
}
