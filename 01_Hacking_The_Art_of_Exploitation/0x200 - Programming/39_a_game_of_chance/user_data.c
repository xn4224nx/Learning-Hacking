#include "user_data.h"

int get_player_data() {

    int file_descriptor, uid, read_bytes;
    struct user entry;
    
    /* Get the current users ID. */
    uid = getuid();
    
    /* Open the data file. */
    file_descriptor = open(DATAFILE,  O_RDONLY);
    
    /* If it can't be opened stop the function. */
    if(file_descriptor == -1) return -1;

    /* Loop over the data file until the current users uid is found. */
    do { 
        read_bytes = read(file_descriptor, &entry, sizeof(struct user));
    } while(entry.uid != uid && read_bytes > 0);
    
    /* close the file. */
    close(file_descriptor);
    
    /* If the end of the file was reached but the user was not found... */
    if (read_bytes < sizeof(struct user)) return -1;
    
    /* Otherwise save the found data into the global user structure. */
    else cur_player = entry;
    
    return 0;
}
