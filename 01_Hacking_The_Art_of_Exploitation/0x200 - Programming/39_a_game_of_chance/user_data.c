#include "user_data.h"

int get_player_data() {

    int file_desc, uid, read_bytes;
    struct user entry;
    
    /* Get the current users ID. */
    uid = getuid();
    
    /* Open the data file. */
    file_desc = open(DATAFILE,  O_RDONLY);
    
    /* If it can't be opened stop the function. */
    if(file_desc == -1) return -1;

    /* Loop over the data file until the current users uid is found. */
    do { 
        read_bytes = read(file_desc, &entry, sizeof(struct user));
    } while(entry.uid != uid && read_bytes > 0);
    
    /* close the file. */
    close(file_desc);
    
    /* If the end of the file was reached but the user was not found... */
    if (read_bytes < sizeof(struct user)) return -1;
    
    /* Otherwise save the found data into the global user structure. */
    else cur_player = entry;
    
    return 0;
}

void register_new_player() {
    
    int file_desc;
    
    printf("-=-={New Player Registration}=-=-\n"
    printf("Enter your name: ");
    get_name_from_player();
    
    /* Set the player variable to default values. */
    cur_player.uid = getuid();
    cur_player.highscore = cur_player.credits = STARTING_CREDITS;
    
    /* Open the data file and save the new player data. */
    file_desc = open(DATAFILE, O_WRONLY|O_CREAT|O_APPEND, S_IRUSR|S_IWUSR);
    
    if(file_desc == -1) fatal("in register_new_player() when opening file.");
    
    write(file_desc, &cur_player, sizeof(struct user));
    close(file_desc);
    
    /* Greet the new user. */
    printf("\nWelcome to the Game of Chance %s.\n", cur_player.name);
    printf("You have been given %u credits.\n", cur_player.credits);
}




























